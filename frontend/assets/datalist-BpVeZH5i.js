import{a as v}from"./axiosinstance-ChhllP2O.js";import{_ as L}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{t as M}from"./index-CMo6u9ZP.js";import{i as f,j as G,r as H,b as J,e as u,o as h,d as l,c as e,g,u as K,R as Q,k as W,l as X,F as Y,m as i}from"./index-BHITr4Qv.js";const Z={__name:"datalist",setup(ee){const{useToken:E}=M;E();const N=[{title:"表名",dataIndex:"table_name",key:"table_name",width:160},{title:"表定义",dataIndex:"table_define_sql",key:"table_define_sql",ellipsis:!0},{title:"字段解释",dataIndex:"table_field_info",key:"table_field_info",ellipsis:!0},{title:"操作",dataIndex:"edit",key:"edit",width:120}],r=()=>{m.value=!0,b.value="",p.value=[],v.get("/api/data/all").then(n=>{p.value=n.data,m.value=!1})},p=f([]);G(()=>{r()});const m=f(!0),c=f(!1),S=n=>{a.table_name=n.table_name,a.table_define_sql=n.table_define_sql,a.table_field_info=n.table_field_info,c.value=!0},C={span:24},q={style:{width:"80px"}},a=H({table_name:"",table_define_sql:"",table_field_info:""}),x=f(!1),z=()=>{a.table_name="",a.table_define_sql="",a.table_field_info="",x.value=!0},F=()=>{if(a.table_name===""){i.error("表名不能为空");return}v.post("/api/data/addtable",a).then(n=>{n.data===!0?(i.success("添加成功"),r(),x.value=!1):i.error("添加失败，请检查表名是否重复")})},P=n=>{v.get("/api/data/rmtable",{params:{table_name:n.table_name}}).then(t=>{t.data===!0?(i.success("删除成功"),r()):i.error("删除失败，请检查表名是否重复")})},R=()=>{if(w.value=!0,a.table_name===""){i.error("表名不能为空"),w.value=!1;return}v.post("/api/data/edittable",a).then(n=>{n.data===!0?(r(),i.success("编辑成功"),c.value=!1):i.error("编辑失败，请检查表名是否重复"),s})},b=f(""),$=()=>{if(b.value===""){r();return}m.value=!0,p.value=[],v.get("/api/data/gettable",{params:{table_name:b.value}}).then(n=>{p.value=n.data,m.value=!1})},w=f(!1);return(n,t)=>{const j=u("a-input-search"),k=u("a-button"),U=u("a-input"),_=u("a-form-item"),y=u("a-textarea"),I=u("a-form"),T=u("a-modal"),B=u("a-layout-content"),O=u("a-card"),A=u("a-popconfirm"),D=u("a-table");return h(),J(B,{class:"main-content"},{default:l(()=>[e(O,{title:"数据列表",style:{width:"100%"},id:"title"},{default:l(()=>[e(B,{class:"search-box"},{default:l(()=>[e(j,{value:b.value,"onUpdate:value":t[0]||(t[0]=o=>b.value=o),placeholder:"请输入数据名称","allow-clear":!0,"enter-button":!0,onSearch:$,style:{width:"300px","margin-bottom":"20px",flex:"1"}},null,8,["value"]),e(k,{type:"primary",onClick:z,style:{"margin-left":"10px"}},{default:l(()=>t[9]||(t[9]=[g("添加数据")])),_:1}),e(k,{type:"primary",onClick:r,style:{"margin-left":"10px"}},{default:l(()=>[e(K(Q))]),_:1}),e(T,{open:x.value,"onUpdate:open":t[4]||(t[4]=o=>x.value=o),title:"编辑",onOk:F,width:"800px",cancelText:"取消",okText:"提交"},{default:l(()=>[e(I,{model:a,"label-col":q,"wrapper-col":C},{default:l(()=>[e(_,{label:"表名"},{default:l(()=>[e(U,{value:a.table_name,"onUpdate:value":t[1]||(t[1]=o=>a.table_name=o)},null,8,["value"])]),_:1}),e(_,{label:"表定义"},{default:l(()=>[e(y,{rows:10,value:a.table_define_sql,"onUpdate:value":t[2]||(t[2]=o=>a.table_define_sql=o)},null,8,["value"])]),_:1}),e(_,{label:"字段解释"},{default:l(()=>[e(y,{rows:10,value:a.table_field_info,"onUpdate:value":t[3]||(t[3]=o=>a.table_field_info=o)},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open"])]),_:1})]),_:1}),e(O,{style:{width:"100%"}},{default:l(()=>[e(D,{columns:N,"data-source":p.value,loading:m.value},{bodyCell:l(({column:o,text:te,record:V})=>[o.dataIndex==="edit"?(h(),W(Y,{key:0},[e(k,{type:"link",onClick:d=>S(V),size:"small"},{default:l(()=>t[10]||(t[10]=[g("编辑")])),_:2},1032,["onClick"]),e(T,{open:c.value,"onUpdate:open":t[8]||(t[8]=d=>c.value=d),title:"编辑",onOk:R,width:"800px",cancelText:"取消",okText:"提交",okButtonProps:{loading:w.value}},{default:l(()=>[e(I,{model:a,"label-col":q,"wrapper-col":C},{default:l(()=>[e(_,{label:"表名"},{default:l(()=>[e(U,{value:a.table_name,"onUpdate:value":t[5]||(t[5]=d=>a.table_name=d)},null,8,["value"])]),_:1}),e(_,{label:"表定义"},{default:l(()=>[e(y,{rows:10,value:a.table_define_sql,"onUpdate:value":t[6]||(t[6]=d=>a.table_define_sql=d)},null,8,["value"])]),_:1}),e(_,{label:"字段解释"},{default:l(()=>[e(y,{rows:10,value:a.table_field_info,"onUpdate:value":t[7]||(t[7]=d=>a.table_field_info=d)},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","okButtonProps"]),e(A,{title:"确定要删除这条数据吗？","cancel-text":"取消","ok-text":"提交",onConfirm:d=>P(V)},{default:l(()=>[e(k,{type:"link",size:"small",danger:""},{default:l(()=>t[11]||(t[11]=[g("删除")])),_:1})]),_:2},1032,["onConfirm"])],64)):X("",!0)]),_:1},8,["data-source","loading"])]),_:1})]),_:1})}}},se=L(Z,[["__scopeId","data-v-778800b2"]]);export{se as default};
